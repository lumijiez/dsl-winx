<!DOCTYPE html>
<html>
<head>
    <title>Graph Visualization</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        #mynetwork {
            width: 100%;
            height: 100vh;
            border: 1px solid lightgray;
        }
    </style>
</head>
<body>
    <div id="mynetwork"></div>

    <script>
        const jsonData = null;

        function generateVisData(data) {
        const nodes = [];
        const edges = [];

        data.forEach(pkg => {
            const pkgId = `pkg-${pkg.name}`;
            nodes.push({
                id: pkgId,
                label: `Package: ${pkg.name}`,
                shape: 'box'
            });

            const interfaceIds = {};

            pkg.interfaces.forEach(iface => {
                const ifaceId = `iface-${iface.name}`;
                interfaceIds[iface.name] = ifaceId;  
                nodes.push({
                    id: ifaceId,
                    label: formatInterface(iface),
                    shape: 'box'
                });
                edges.push({ from: pkgId, to: ifaceId });

                iface.functions.forEach(func => {
                    const funcId = `func-${iface.name}-${func.name}`;
                    nodes.push({
                        id: funcId,
                        label: formatFunction(func),
                        shape: 'box'
                    });
                    edges.push({ from: ifaceId, to: funcId });

                    if (func.implemented_interface && func.implemented_interface !== "none" && interfaceIds[func.implemented_interface]) {
                        edges.push({ from: funcId, to: interfaceIds[func.implemented_interface] });
                    }
                });
            });

            pkg.specifications.forEach(spec => {
                const specId = `spec-${spec.name}`;
                nodes.push({
                    id: specId,
                    label: formatSpecification(spec),
                    shape: 'box'
                });
                edges.push({ from: pkgId, to: specId });

                spec.functions.forEach(func => {
                    const funcId = `func-${spec.name}-${func.name}`;
                    nodes.push({
                        id: funcId,
                        label: formatFunction(func),
                        shape: 'box'
                    });
                    edges.push({ from: specId, to: funcId });

                    if (func.implemented_interface && func.implemented_interface !== "none" && interfaceIds[func.implemented_interface]) {
                        edges.push({ from: funcId, to: interfaceIds[func.implemented_interface] });
                    }
                });
            });
        });

        return { nodes: new vis.DataSet(nodes), edges: new vis.DataSet(edges) };
    }

    function formatInterface(iface) {
        return `Interface: ${iface.name}`;
    }

    function formatFunction(func) {
        let label = `Function: ${func.name}\nAccess: ${func.access_modifier}`;
        label += `\nImplements: ${func.implemented_interface}`;
        label += `\nImportance: ${func.importance}`;
        func.inputTypes.forEach(input => {
            label += `\nInput: ${input.type} ${input.identifier}`;
        });
        func.returnTypes.forEach(ret => {
            label += `\nReturn: ${ret.type} ${ret.identifier}`;
        });
        func.specificationEntries.forEach(entry => {
            label += `\n${entry.key}: ${entry.value}`;
        });
        return label;
    }

    function formatSpecification(spec) {
        let label = `Specification: ${spec.name}\nImplements: ${spec.implementedInterface}`;
        spec.requirements.forEach(req => {
            label += `\nRequirement: ${req.name}`;
            req.annotations.forEach(anno => {
                label += `\n - ${anno.name} (${anno.importance})`;
            });
        });
        spec.results.forEach(result => {
            label += `\nResult: ${result.name} (${result.importance})`;
        });
        return label;
    }

    const { nodes, edges } = generateVisData(jsonData);

    const container = document.getElementById('mynetwork');
    const data = {
        nodes: nodes,
        edges: edges
    };
    const options = {
        nodes: {
            font: {
                multi: 'html',
                size: 14
            }
        },
        layout: {
            randomSeed: undefined,
            improvedLayout: true,
            clusterThreshold: 150,
            hierarchical: {
                enabled: true, 
                levelSeparation: 150,
                nodeSpacing: 300,
                treeSpacing: 200,
                blockShifting: true,
                edgeMinimization: true,
                parentCentralization: true,
                direction: 'UD',  
                sortMethod: 'directed'  
            }
        },
        edges: {
            smooth: {
                type: 'dynamic',
                roundness: 0.5
            },
            length: 400  
        }
    };
    const network = new vis.Network(container, data, options);
    </script>
</body>
</html>
